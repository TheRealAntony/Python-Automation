name: Cross-Platform CI/CD

on:
  workflow_dispatch:
    inputs:
      os:
        description: 'Select OS to build on'
        required: true
        default: 'all'
        type: choice
        options:
          - linux
          - windows
          - macos
          - all

      push_to_s3:
        description: 'Push to S3?'
        required: true
        default: 'false'
        type: choice
        options:
          - true
          - false

      deploy:
        description: 'Deploy to production?'
        required: true
        default: 'false'
        type: choice
        options:
          - true
          - false     

# --- Manual trigger jobs ---
jobs:
  select-os:
    if: ${{ github.event_name == 'workflow_dispatch' }}
    runs-on: ubuntu-latest
    outputs:
      os: ${{ steps.set.outputs.os }}
      push_to_s3: ${{ steps.set.outputs.push_to_s3 }}
      deploy: ${{ steps.set.outputs.deploy }}
    steps:
      - id: set
        run: |
          echo "os=${{ github.event.inputs.os }}" >> $GITHUB_OUTPUT
          echo "push_to_s3=${{ github.event.inputs.push_to_s3 }}" >> $GITHUB_OUTPUT
          echo "Selected OS: ${{ github.event.inputs.os }}"
          echo "Push to S3: ${{ github.event.inputs.push_to_s3 }}"
          echo "Inputs set successfully."

  manual-linux:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'linux' || needs.select-os.outputs.os == 'all') }}
    needs: [select-os]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Linux Build
        run: |
          echo "üèóÔ∏è Building on Linux"
          sleep 1
          echo "‚úÖ Linux build complete"

  manual-windows:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'windows' || needs.select-os.outputs.os == 'all') }}
    needs: [select-os]
    runs-on: windows-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Windows Build
        run: |
          echo "üèóÔ∏è Building on Windows"
          echo "‚úÖ Windows build complete"

  manual-macos:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'macos' || needs.select-os.outputs.os == 'all') }}
    needs: [select-os]
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate macOS Build
        run: |
          echo "üèóÔ∏è Building on macOS"
          sleep 1
          echo "‚úÖ macOS build complete"

# --- Push to 'linux' branch job ---
  push-s3-linux:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'linux' || needs.select-os.outputs.os == 'all') && needs.select-os.outputs.push_to_s3 == 'true' }}
    needs: [select-os]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Push to S3 - Linux
        run: |
          echo "üì¶ Pushing to S3..."
          sleep 1
          echo "‚úÖ Pushed to S3 successfully"

  push-s3-windows:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'windows' || needs.select-os.outputs.os == 'all') && needs.select-os.outputs.push_to_s3 == 'true' }}
    needs: [select-os]
    runs-on: windows-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Push to S3 - Windows
        run: |
          echo "üì¶ Pushing to S3..."
          echo "‚úÖ Pushed to S3 successfully"

  push-s3-mac:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'macos' || needs.select-os.outputs.os == 'all') && needs.select-os.outputs.push_to_s3 == 'true' }}
    needs: [select-os]
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Push to S3 - macOS
        run: |
          echo "üì¶ Pushing to S3..."
          sleep 1
          echo "‚úÖ Pushed to S3 successfully"

  deploy_to_linux:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'linux' || needs.select-os.outputs.os == 'all') && needs.select-os.outputs.deploy == 'true' }}
    needs: [select-os]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Deploy to Production - Linux
        run: |
          echo "üöÄ Deploying to production..."
          sleep 1
          echo "‚úÖ Deployed to production successfully"

  deploy_to_windows:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'windows' || needs.select-os.outputs.os == 'all') && needs.select-os.outputs.deploy == 'true' }}
    needs: [select-os]
    runs-on: windows-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Deploy to Production - Windows
        run: |
          echo "üöÄ Deploying to production..."
          echo "‚úÖ Deployed to production successfully"

  deploy_to_mac:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'macos' || needs.select-os.outputs.os == 'all') && needs.select-os.outputs.deploy == 'true' }}
    needs: [select-os]
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Simulate Deploy to Production - macOS
        run: |
          echo "üöÄ Deploying to production..."
          sleep 1
          echo "‚úÖ Deployed to production successfully"                
