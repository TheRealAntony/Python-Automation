name: Cross-Platform Build

on:
  workflow_dispatch:
    inputs:
      os:
        description: 'Select OS to build on'
        required: true
        default: 'all'
        type: choice
        options:
          - linux
          - windows
          - macos
          - all

      build_type:
        description: 'Build type'
        required: true
        default: 'debug'
        type: choice
        options:
          - debug
          - release

      run_tests:
        description: 'Run tests?'
        required: true
        default: 'false'
        type: choice
        options:
          - true
          - false

  push:
    branches:
      - dev

# --- Manual Only ---
jobs:
  select-os:
    if: ${{ github.event_name == 'workflow_dispatch' }}
    runs-on: ubuntu-latest
    outputs:
      selected_os: ${{ steps.set.outputs.os }}
      build_type: ${{ steps.set.outputs.build_type }}
      run_tests: ${{ steps.set.outputs.run_tests }}
    steps:
      - id: set
        run: |
          echo "os=${{ github.event.inputs.os }}" >> $GITHUB_OUTPUT
          echo "build_type=${{ github.event.inputs.build_type }}" >> $GITHUB_OUTPUT
          echo "run_tests=${{ github.event.inputs.run_tests }}" >> $GITHUB_OUTPUT

  manual-linux:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'linux' || needs.select-os.outputs.os == 'all') }}
    needs: [select-os]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: |
          echo "ğŸ—ï¸ Building on Linux with ${{ needs.select-os.outputs.build_type }}"
          if [[ "${{ needs.select-os.outputs.run_tests }}" == "true" ]]; then
            echo "âœ… Running tests on Linux"
          else
            echo "âŒ Skipping tests on Linux"
          fi

  manual-windows:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'windows' || needs.select-os.outputs.os == 'all') }}
    needs: [select-os]
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - run: |
          echo "ğŸ—ï¸ Building on Windows with ${{ needs.select-os.outputs.build_type }}"
          if "${{ needs.select-os.outputs.run_tests }}" == "true"; then
            echo "âœ… Running tests on Windows"
          else
            echo "âŒ Skipping tests on Windows"
          fi

  manual-macos:
    if: ${{ github.event_name == 'workflow_dispatch' && (needs.select-os.outputs.os == 'macos' || needs.select-os.outputs.os == 'all') }}
    needs: [select-os]
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - run: |
          echo "ğŸ—ï¸ Building on macOS with ${{ needs.select-os.outputs.build_type }}"
          if [[ "${{ needs.select-os.outputs.run_tests }}" == "true" ]]; then
            echo "âœ… Running tests on macOS"
          else
            echo "âŒ Skipping tests on macOS"
          fi

# --- Push to Dev ---
  push-linux:
    if: ${{ github.event_name == 'push' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: echo "ğŸš€ Push Build on Linux (dev branch)"

  push-windows:
    if: ${{ github.event_name == 'push' }}
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - run: echo "ğŸš€ Push Build on Windows (dev branch)"

  push-macos:
    if: ${{ github.event_name == 'push' }}
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - run: echo "ğŸš€ Push Build on macOS (dev branch)"
